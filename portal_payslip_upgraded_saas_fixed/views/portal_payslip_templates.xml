<odoo>
    <template id="portal_my_payslips_page">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2><i class="fa fa-file-invoice-dollar"></i> My Payslips</h2>
                    <a class="btn btn-outline-secondary" href="/my">Back</a>
                </div>

                <!-- Filters -->
                <form method="get" class="row mb-4">
                    <div class="col-md-4">
                        <label>Month</label>
                        <select name="month" class="form-select">
                            <option value="">All</option>
                            <t t-foreach="range(1,13)" t-as="m">
                                <option t-att-value="m" t-att-selected="m == selected_month"><t t-esc="m"/></option>
                            </t>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label>Year</label>
                        <select name="year" class="form-select">
                            <option value="">All</option>
                            <t t-foreach="range(2020,2032)" t-as="y">
                                <option t-att-value="y" t-att-selected="y == selected_year"><t t-esc="y"/></option>
                            </t>
                        </select>
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-primary w-100">Apply</button>
                    </div>
                </form>

                <!-- KPI Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card p-3 shadow-sm text-center">
                            <h3><t t-esc="total_payslips"/></h3>
                            <p>Total Payslips</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card p-3 shadow-sm text-center">
                            <h5><t t-esc="last_period or '—'"/></h5>
                            <p>Last Period</p>
                        </div>
                    </div>
                </div>

                <!-- Payslip Cards -->
                <div class="row">
                    <t t-foreach="payslips" t-as="slip">
                        <div class="col-md-4 mb-3">
                            <div class="card p-3 shadow-sm h-100">
                                <h4><t t-esc="slip.number or 'Payslip'"/></h4>
                                <p class="text-muted">
                                    <t t-esc="slip.date_from"/> → <t t-esc="slip.date_to"/>
                                </p>
                                <span class="badge bg-info text-dark"><t t-esc="slip.state"/></span>

                                <div class="mt-auto">
                                    <a t-attf-href="/my/payslips/{{ slip.id }}/download"
                                       class="btn btn-primary btn-sm w-100 mt-2">Download PDF</a>

                                    <!-- Attachments -->
                                    <t t-if="attachments.get(slip.id)">
                                        <ul class="list-unstyled small mt-2">
                                            <t t-foreach="attachments[slip.id]" t-as="att">
                                                <li>
                                                    <a t-att-href="'/web/content/%s?download=1' % att.id">
                                                        <i class="fa fa-paperclip"></i> <t t-esc="att.name"/>
                                                    </a>
                                                </li>
                                            </t>
                                        </ul>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>

            </div>
        </t>
    </template>
</odoo>
